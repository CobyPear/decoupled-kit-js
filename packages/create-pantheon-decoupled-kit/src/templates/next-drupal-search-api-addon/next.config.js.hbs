{{> sharedNextDrupalConfig}}

module.exports = async () => {
	const locales = await getLocales();
	const nextConfig = {
		experimental: {
			appDir: true,
		},
		...(injectedOptions && injectedOptions),
		env: {
			backendUrl: backendUrl,
			// set imageUrl if IMAGE_DOMAIN is set in env vars to override default
			imageUrl: `https://${imageDomain}`,
			// makes locales available to lib/stores.js
			locales: locales,
		},
		reactStrictMode: true,
		images: {
			domains: [imageDomain],
		},
		i18n: {
			locales: locales,
			defaultLocale: 'en',
		},
		output: 'standalone',
		async rewrites() {
			return [
				{
					// inline-images can still be fetched from their source
					source: '/sites/default/:path*',
					destination: `${backendUrl}/sites/default/:path*`,
				},
			];
		},
	};

	return nextConfig;
};
